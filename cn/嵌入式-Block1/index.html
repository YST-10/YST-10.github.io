<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxx-xx"></script>
    <script type="text/javascript">
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-xxxxxx-xx');
    </script>
  

  <!-- Baidu Tongji -->
  
    <script type="text/javascript">
      // Originial
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  <!-- Baidu Push -->
  
    <script>
      (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
      })();
    </script>
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc"/>
  <meta name="baidu-site-verification" content="PpzM9WxOJU"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="This is a casual blogging space..."/>
  <meta name="keyword" content="YST,computer,deep learning,IoT,blog,Blog,machine learning"/>
  <link rel="shortcut icon" href="/img/avatar/roguerabbit.jpg"/>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- viewer start (Picture preview) -->
      <link rel="stylesheet" href="/css/viewer.min.css"/>
      <!-- viewer end -->
    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- gitalk start -->
      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->
      <link rel="stylesheet" href="/css/gitalk.css"/>
      <!-- gitalk end -->
    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="http://example.com/cn/嵌入式-Block1/">
  <title>
    
      北邮果园物联嵌入式系统第一模块笔记 - either fight | or die
    
  </title>
<meta name="generator" content="Hexo 5.4.0"></head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--dark">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'dark';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		
		<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'your-community/your-room'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">YST的博客</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">首页</a>
          </li>

          
          
          
          
          <li>
            <a href="/categories/">
              
              分类
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/archive/">
              
              归档
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/about/">
              
              关于
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/tags/">
              
              标签
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>搜索</a>
          </li>
          

          <!-- LangSelect -->
          
          
          
          
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: url('/img/header_img/lml_bg.jpg');
      --intro-header-background-image-url-page: url('//img/header_img/lml_bg.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/lml_bg.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('//img/header_img/lml_bg.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('/img/header_img/lml_bg.jpg'); */
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
              <a class="tag" href="/tags/#Embedded System" title="Embedded System">Embedded System</a>
              
            </div>
            <h1>北邮果园物联嵌入式系统第一模块笔记</h1>
            <h2 class="subheading">Embedded System...</h2>
            <span class="meta">
              Posted by YST on
              2024-04-17
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">42</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">10.3k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            
            <!-- 不蒜子统计 start -->
            <span class="meta" id="busuanzi_container_page_pv">
              Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
            </span>
            <!-- 不蒜子统计 end -->
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <h1 id="EBU5477-Embedded-Systems-Block1"><a href="#EBU5477-Embedded-Systems-Block1" class="headerlink" title="EBU5477 Embedded Systems Block1"></a>EBU5477 Embedded Systems Block1</h1><h2 id="02-Introduction-to-Embedded-Systems-Design"><a href="#02-Introduction-to-Embedded-Systems-Design" class="headerlink" title="02 Introduction to Embedded Systems Design"></a>02 Introduction to Embedded Systems Design</h2><h3 id="1-What-is-an-Embedded-System"><a href="#1-What-is-an-Embedded-System" class="headerlink" title="1. What is an Embedded System"></a>1. What is an Embedded System</h3><h4 id="1-定义：-An-embedded-system-is-a-computerised-system-that-is-purpose-built-for-its-application-嵌入式系统是一种专门为其应用而设计的计算机化系统。"><a href="#1-定义：-An-embedded-system-is-a-computerised-system-that-is-purpose-built-for-its-application-嵌入式系统是一种专门为其应用而设计的计算机化系统。" class="headerlink" title="(1) 定义： An embedded system is a computerised system that is purpose-built for its application.  嵌入式系统是一种专门为其应用而设计的计算机化系统。"></a>(1) 定义：<font color=red> <strong>An embedded system is a computerised system that is purpose-built for its application.</strong> </font> <strong>嵌入式系统是一种专门为其应用而设计的计算机化系统。</strong></h4><h4 id="2-特点"><a href="#2-特点" class="headerlink" title="(2) 特点"></a>(2) 特点</h4><ul>
<li>An embedded system has <strong>less support for things that are unrelated</strong> to accomplishing the job at hand. The <strong>hardware often has constraints</strong>.  嵌入式系统对与完成手头工作无关的事情的支持较少。硬件通常会有一些限制。</li>
</ul>
<p>​       例：a CPU that runs more slowly to save battery power 为了节省电池功耗而运行速度较慢的CPU</p>
<ul>
<li><p>The embedded software must <strong>act exactly the same</strong> <strong>each time (deterministically)</strong> or <strong>in real time</strong> (always reacting to an event fast enough). 嵌入式软件必须在每次（确定性）或实时（总是对事件做出反应）采取完全相同的操作。</p>
</li>
<li><p>Some systems require that the software be <strong>fault-tolerant</strong>, with graceful degradation in the face of errors. (e.g. a tracking tag on a whale) 有些系统要求软件具有容错能力，在出现错误时能够优雅地降级。例如，鲸鱼追踪标签就需要具备容错能力。</p>
</li>
</ul>
<h4 id="3-例子"><a href="#3-例子" class="headerlink" title="(3) 例子"></a>(3) 例子</h4><h5 id="Bike-Computer-自行车计算机"><a href="#Bike-Computer-自行车计算机" class="headerlink" title=" Bike Computer 自行车计算机"></a><1> Bike Computer 自行车计算机</h5><ul>
<li><p>Functions  </p>
<ul>
<li>Speed and distance measurement 速度距离测量</li>
</ul>
</li>
<li><p>Constraints</p>
<ul>
<li>Size</li>
<li>Cost</li>
<li>Power and Energy</li>
<li>Weight</li>
</ul>
</li>
<li><p>Inputs</p>
<ul>
<li>Wheel rotation indicator  轮轴旋转指示器（检测车轮旋转测量速度距离）</li>
<li>Mode key（模式按键，用于切换功能）</li>
</ul>
</li>
<li><p>Output</p>
<ul>
<li>Liquid Crystal Display 液晶显示屏，显示速度，距离信息     <img src="/img/typora-user-images/image-20240513131755716.png" alt="image-20240513131755716" style="zoom:50%;" /></li>
</ul>
</li>
<li><p>Low performance MCU 低性能的微控制器单元（MCU）（核心处理器）</p>
<ul>
<li>8-bit, 10 MIPS (Million Instructions Per Second)</li>
</ul>
</li>
</ul>
<h5 id="Motor-Control-Unit-in-Electric-Vehicles-电动汽车中的电机控制单元"><a href="#Motor-Control-Unit-in-Electric-Vehicles-电动汽车中的电机控制单元" class="headerlink" title=" Motor Control Unit in Electric Vehicles 电动汽车中的电机控制单元"></a><2> Motor Control Unit in Electric Vehicles 电动汽车中的电机控制单元</h5><ul>
<li><p>Functions</p>
<ul>
<li>Motor control 电机控制</li>
<li>System communications 系统通信</li>
<li>Current monitoring 电流监测</li>
<li>Rotation speed detection 转速检测</li>
</ul>
</li>
<li><p>Constraints</p>
<ul>
<li>Reliability in harsh environment 恶劣环境中的可靠性</li>
<li>Cost</li>
<li>Weight</li>
</ul>
</li>
<li><p>Many Inputs and Outputs</p>
<ul>
<li>Discrete sensors &amp; actuators 离散传感器和执行器</li>
<li>Network interface to rest of car 与车辆其余部分的网络接口</li>
</ul>
</li>
<li><p>High Performance MCU 高性能的微控制器单元（MCU）</p>
<ul>
<li>32-bit, 256 KB flash memory, 80 MHz</li>
</ul>
</li>
</ul>
<h3 id="2-The-Core-Components-in-Embedded-Systems"><a href="#2-The-Core-Components-in-Embedded-Systems" class="headerlink" title="2. The Core Components in Embedded Systems"></a>2. The Core Components in Embedded Systems</h3><p><img src="/img/typora-user-images/image-20240308165626543.png" alt="image-20240308165626543"></p>
<h3 id="3-Embedded-Systems-Development-嵌入式系统开发"><a href="#3-Embedded-Systems-Development-嵌入式系统开发" class="headerlink" title="3. Embedded Systems Development 嵌入式系统开发"></a>3. Embedded Systems Development 嵌入式系统开发</h3><ul>
<li><p>Most embedded software engineers develop a toolkit for dealing with the constraints. 处理限制的工具</p>
</li>
<li><p><strong>Compilers and Languages </strong>   编译器和语言</p>
<ul>
<li>Embedded systems use <strong>cross-compilers</strong> to generate code image to run on your target embedded system   嵌入式系统使用交叉编译器来生成要在目标嵌入式系统上运行的代码映像</li>
<li>Embedded software compilers often support only <strong>C, or C and C++</strong>.</li>
</ul>
</li>
<li><p><strong>Debugging</strong> 调试</p>
<ul>
<li>Embedded systems use <strong>cross-debuggers</strong>: the debugger sits on your computer and communicates with the target processor through a special processor interface (JTAG)   嵌入式系统使用交叉调试器：调试器位于您的计算机上，并通过一个特殊的处理器接口（JTAG）与目标处理器进行通信</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240308202310052.png" alt="image-20240308202310052"></p>
<p>​                                                                                            <em>Computer and target processor</em></p>
<ul>
<li>流程<ul>
<li>首先在计算机上编写嵌入式处理器的<strong>源代码</strong>（例如 Source.c）。</li>
<li>然后使用<strong>交叉编译器和链接器</strong>编译和链接源代码。由于您的计算机（宿主）与嵌入式处理器（目标）的架构不同，因此需要使用交叉编译器。</li>
<li>结果是为目标处理器特别编译的<strong>镜像文件</strong>。</li>
<li>编译后的镜像文件随后被<strong>加载到嵌入式处理器</strong>上。这一步可能包括通过各种方法（如 JTAG（用于调试和编程的标准）、串行通信等）将代码复制到处理器的内存中。</li>
<li>处理器接收并存储代码在其<strong>代码空间</strong>内，处理器在此执行软件。</li>
<li>用于调试的硬件和软件接口：<ul>
<li>嵌入式处理器通常配备了<strong>有限的硬件支持</strong>来进行调试。这通常包括像 JTAG 或串行连接这样的接口。</li>
<li>当处理器运行软件时，它输出调试消息，这对开发者了解处理器内部发生的事情至关重要。</li>
</ul>
</li>
<li>计算机上的<strong>交叉调试器</strong>通过调试接口连接到嵌入式处理器。<ul>
<li>它允许您执行各种调试活动，如开始和停止代码执行、逐步执行代码、检查和修改变量以及重置处理器。</li>
</ul>
</li>
<li><strong>串行端口终端</strong>：<ul>
<li>这个终端在计算机上用于查看和交互来自嵌入式处理器的运行软件<strong>输出和调试消息</strong>。这可以包括通过串行接口路由的打印语句或其他调试信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-Embedded-Systems-Attributes-三条"><a href="#4-Embedded-Systems-Attributes-三条" class="headerlink" title="4. Embedded Systems: Attributes (三条)"></a>4. Embedded Systems: Attributes (三条)</h3><h4 id="1-Interfacing-with-larger-system-and-environment-lt-font-gt-与更大的系统和环境交互"><a href="#1-Interfacing-with-larger-system-and-environment-lt-font-gt-与更大的系统和环境交互" class="headerlink" title="(1) Interfacing with larger system and environment&lt;/font &gt;      与更大的系统和环境交互"></a>(1) <font color=red>Interfacing with larger system and environment&lt;/font &gt;      与更大的系统和环境交互</h4><ul>
<li><p><strong>Analog signals</strong> for reading sensors.  Typically use a <strong>voltage</strong> to represent a physical value</p>
<p>模拟信号用于读取传感器。  通常使用电压表示物理值，如温度等</p>
</li>
<li><p>Power electronics for driving motors  使用功率电子器件来控制电机的运行，例如直流电机、步进电机等</p>
</li>
<li><p><strong>Digital interfaces</strong> for <strong>communicating</strong> with other digital devices  用于与其他数字设备进行通信的数字接口</p>
<ul>
<li>Simple - switches  开关</li>
<li>Complex - displays 显示器</li>
</ul>
</li>
<li><h4 id="Example-Analog-Sensor-Depth-Gauge-深度计-使用模拟压力传感器和模拟至数字转换器（ADC）来测量深度-没啥用吧"><a href="#Example-Analog-Sensor-Depth-Gauge-深度计-使用模拟压力传感器和模拟至数字转换器（ADC）来测量深度-没啥用吧" class="headerlink" title="Example: Analog Sensor - Depth Gauge  深度计(使用模拟压力传感器和模拟至数字转换器（ADC）来测量深度)   没啥用吧"></a><strong>Example: Analog Sensor - Depth Gauge</strong>  深度计(使用模拟压力传感器和模拟至数字转换器（ADC）来测量深度)   没啥用吧</h4></li>
</ul>
<p><img src="/img/typora-user-images/image-20240308210410050.png" alt="image-20240308210410050"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ADC_Code;<span class="comment">// 从传感器读取的原始模拟到数字转换器（ADC）值</span></span><br><span class="line"><span class="keyword">float</span> V_sensor;<span class="comment">// 传感器输出的电压</span></span><br><span class="line"><span class="keyword">float</span> Pressure_kPa;<span class="comment">// 压力值（以千帕斯卡为单位）</span></span><br><span class="line"><span class="keyword">float</span> Depth_ft;<span class="comment">// 深度值（以英尺为单位）</span></span><br><span class="line">ADC_Code = adc_read();<span class="comment">// 软件通过读取ADC的输出（使用`adc_read()`函数）来获取ADC_Code。</span></span><br><span class="line"><span class="comment">// 1.将ADC值转换为传感器的电压值（单位：伏特）</span></span><br><span class="line"><span class="comment">// V_ref是参考电压，ADC_MASK是ADC的掩码或最大值</span></span><br><span class="line">V_sensor = ADC_Code * V_ref / ADC_MASK;</span><br><span class="line"><span class="comment">// 2.将传感器的电压值转换为压力值（单位：千帕斯卡）</span></span><br><span class="line"><span class="comment">// 这里的系数和偏移量根据传感器的特性和校准而定</span></span><br><span class="line">Pressure_kPa = <span class="number">250</span> * (V_sensor / <span class="number">3.3</span> + <span class="number">0.04</span>);</span><br><span class="line"><span class="comment">// 3.将压力值转换为深度值（单位：英尺）</span></span><br><span class="line"><span class="comment">// 33和101.3是水的密度和地球的重力加速度的常数</span></span><br><span class="line"><span class="comment">// Atmos_Press_kPa是环境的大气压力，用以校正深度值</span></span><br><span class="line">Depth_ft = <span class="number">33</span> * (Pressure_kPa - Atmos_Press_kPa) / <span class="number">101.3</span>;</span><br></pre></td></tr></table></figure>
<p><1> 传感器检测压力，并产生一个正比例的输出电压V_sensor</p>
<p><2> 数字转换器ADC将从压力传感器获得的模拟电压信号（V_sensor）转换成数字信号（ADC_Code）。转换的过程依赖于参考电压（V_ref）。</p>
<p><3> 代码可以将这个整数转换为一个更有用的东西</p>
<ul>
<li>首先一个浮点代表电压</li>
<li>然后另一个浮点代表压力</li>
<li>最后另一个浮点代表深度</li>
</ul>
<p>电压到ADC输出代码的一些例子。例如，当V_sensor接近V_ref时，输出代码为111.111（假设为最高值）；当V_sensor为接地电压时，输出代码为最低（000.000）。</p>
<h4 id="2-Concurrent-reactive-behaviours-并发，反应性行为"><a href="#2-Concurrent-reactive-behaviours-并发，反应性行为" class="headerlink" title="(2) Concurrent, reactive behaviours   并发，反应性行为"></a>(2) <strong><font color=red>Concurrent, reactive behaviours</font></strong>   并发，反应性行为</h4><ul>
<li><p>Continuously react to inputs from the environment by generating corresponding outputs  通过产生相应的输出，不断地响应来自环境的输入 </p>
</li>
<li><p>Required to respond to sequences and combinations of events      需要响应事件的序列和组合</p>
</li>
<li><p><strong>Real-time</strong> systems have <strong>deadlines</strong> on responses       实时系统有响应的截止日期</p>
</li>
<li><p>Typically perform multiple separate activities concurrently     通常并发执行多个单独的活动</p>
</li>
<li><p>Typical applications include vehicle control, consumer electronics, remote sensing, smart household appliances etc.  典型的应用包括车辆控制、消费电子产品、遥感、智能家用电器等。</p>
</li>
<li><h4 id="Example-Hardware-amp-Software-Concurrency"><a href="#Example-Hardware-amp-Software-Concurrency" class="headerlink" title="Example Hardware &amp; Software: Concurrency"></a>Example Hardware &amp; Software: Concurrency</h4></li>
</ul>
<p><1><strong>CPU executes instructions</strong> from one or more thread of execution    CPU从一个或多个执行的线程中执行指令</p>
<p><2><strong>Specialised hardware</strong> <strong>peripherals</strong> add dedicated concurrent processing    专门的硬件外设添加了专用的并发处理</p>
<ul>
<li><ul>
<li>Watchdog timer 监视计时器：一种硬件计时器，用于监视系统的运行情况。如果系统在特定时间间隔内未能向看门狗定时器发送重置信号，系统将被认为已经崩溃，会触发预定义的故障恢复程序。</li>
<li>Analog interfacing 模拟接口:  模拟接口允许数字系统与模拟电路进行通信。这种接口可以用来采集传感器数据、控制模拟设备或与模拟信号进行通信。</li>
<li>Timers  定时器：一种硬件设备，用于生成精确的时间延迟或周期性触发。它们常用于时间相关的任务，例如控制周期性事件的发生或执行时间敏感的操作。</li>
</ul>
</li>
<li>Communications with other devices 与其它设备通信</li>
<li>Detecting external signal events 检测外部信号事件</li>
<li>LCD driver      LCD驱动器， LCD（液晶显示器）驱动器是用于控制液晶显示器的硬件模块。它负责将图像数据发送到LCD，并控制其显示。</li>
</ul>
<p><3>Peripherals use <strong>interrupts</strong> to notify CPU of events  外设使用中断来通知事件的CPU</p>
<p><img src="/img/typora-user-images/image-20240310164251128.png" alt="image-20240310164251128" style="zoom: 67%;" />         <img src="/img/typora-user-images/image-20240310164322438.png" alt="image-20240310164322438"  /></p>
<p><4>Embedded systems rely on both <strong>hardware peripherals and software (running on MCU)</strong> to get everything done on time  嵌入式系统依赖于硬件外设和软件（运行在单片机上）来按时完成所有工作</p>
<h4 id="3-Fault-handling-amp-Diagnostics-故障处理与诊断"><a href="#3-Fault-handling-amp-Diagnostics-故障处理与诊断" class="headerlink" title="(3) Fault handling &amp; Diagnostics      故障处理与诊断"></a><strong>(3) <font color=red>Fault handling &amp; Diagnostics </font></strong>     故障处理与诊断</h4><ul>
<li>Many systems must <strong>operate independently for long periods of time</strong>, requiring system to <strong>handle likely faults without crashing</strong>.   许多系统必须长时间独立运行，要求系统处理可能的故障而不崩溃。</li>
<li>Often <strong>fault-handling code</strong> is <strong>larger and more complex</strong> than the normal-case code.  故障处理代码通常比普通情况下的代码更大、更复杂。</li>
<li><strong>Logs/records stored in memory/disk</strong> help service personnel <strong>determine problem quickly</strong>  存储在内存/磁盘中的日志/记录帮助服务人员快速确定问题</li>
</ul>
<h3 id="5-Embedded-System-Applications-（4点）"><a href="#5-Embedded-System-Applications-（4点）" class="headerlink" title="5. Embedded System: Applications  （4点）"></a>5. Embedded System: Applications  （4点）</h3><h4 id="1-Closed-loop-control-system-闭环控制系统"><a href="#1-Closed-loop-control-system-闭环控制系统" class="headerlink" title="(1) Closed-loop control system  闭环控制系统"></a>(1) Closed-loop control system  闭环控制系统</h4><ul>
<li>Monitor a process, adjust an output to maintain desired set point (temperature, speed, direction, etc.)  监控一个过程，调整一个输出，以保持所需的设定值（温度、速度、方向等）。</li>
<li>自动温室系统</li>
</ul>
<h4 id="2-Sequencing-顺序控制"><a href="#2-Sequencing-顺序控制" class="headerlink" title="(2) Sequencing  顺序控制"></a>(2) Sequencing  顺序控制</h4><ul>
<li>Step through different stages based on environment and system  根据环境和系统，逐步进入不同的阶段</li>
<li>洗衣机，交通信号灯控制系统</li>
</ul>
<h4 id="3-Signal-processing-信号处理"><a href="#3-Signal-processing-信号处理" class="headerlink" title="(3) Signal processing  信号处理"></a>(3) Signal processing  信号处理</h4><ul>
<li>Remove noise, select desired signal features    消除噪声，选择所需的信号特征</li>
<li>医疗设备，数字音频处理系统</li>
</ul>
<h4 id="4-Communications-and-networking-通信与网络"><a href="#4-Communications-and-networking-通信与网络" class="headerlink" title="(4) Communications and networking  通信与网络"></a>(4) Communications and networking  通信与网络</h4><ul>
<li>Exchange information reliably and quickly  可靠、快速地交换信息</li>
<li>无线传感器网络（WSN），IoT设备</li>
</ul>
<h3 id="6-Benefits-of-Embedded-Systems（3点）性能-成本-可靠"><a href="#6-Benefits-of-Embedded-Systems（3点）性能-成本-可靠" class="headerlink" title="6. Benefits of Embedded Systems（3点）性能+成本+可靠"></a>6. Benefits of Embedded Systems（3点）性能+成本+可靠</h3><h4 id="1-Greater-performance-and-efficiency-更好的性能和效率"><a href="#1-Greater-performance-and-efficiency-更好的性能和效率" class="headerlink" title="(1) Greater performance and efficiency 更好的性能和效率"></a>(1) Greater performance and efficiency 更好的性能和效率</h4><ul>
<li><strong>Software</strong> makes it possible to provide sophisticated control 软件使提供复杂的控制成为可能</li>
</ul>
<h4 id="2-Lower-costs-更低的成本（组件-制造-维护）"><a href="#2-Lower-costs-更低的成本（组件-制造-维护）" class="headerlink" title="(2) Lower costs  更低的成本（组件+制造+维护）"></a>(2) Lower costs  更低的成本（组件+制造+维护）</h4><ul>
<li><strong>Less expensive components</strong> can be used   e.g. standard LCD display that works with standard MCUs  可以使用更便宜的组件，例如使用标准mcu的标准LCD显示器</li>
<li><strong>Manufacturing costs</strong> reduced – mass production  制造成本降低-大规模生产</li>
<li><strong>Maintenance costs reduced</strong> – fewer components  维护成本降低-更少的组件</li>
</ul>
<h4 id="3-Better-dependability-更好地可靠性"><a href="#3-Better-dependability-更好地可靠性" class="headerlink" title="(3) Better dependability 更好地可靠性"></a>(3) Better dependability 更好地可靠性</h4><ul>
<li><strong>Adaptive system</strong> which can compensate for failures    e.g. when the motor is overheated, slow it down  自适应系统可以补偿故障，如电机过热，减速</li>
<li><strong>Better diagnostics (e.g. logging)</strong> to improve repair time  更好的诊断方法（例如，日志记录），以提高维修时间</li>
</ul>
<h3 id="7-Embedded-Design-Constraints（5点）"><a href="#7-Embedded-Design-Constraints（5点）" class="headerlink" title="7. Embedded Design: Constraints（5点）"></a>7. Embedded Design: Constraints（5点）</h3><h4 id="1-Cost-成本"><a href="#1-Cost-成本" class="headerlink" title="(1) Cost  成本"></a>(1) Cost  成本</h4><ul>
<li>Competitive markets penalise products which don’t deliver adequate value for the cost  竞争激烈的市场会惩罚那些没有提供足够的成本价值的产品</li>
</ul>
<h4 id="2-Computation-计算"><a href="#2-Computation-计算" class="headerlink" title="(2) Computation 计算"></a>(2) Computation 计算</h4><ul>
<li>Memory (RAM), code space (ROM or flash), processor cycles or speed, power consumption (see below), processor peripherals   存储器（RAM）、代码空间(ROM或闪存）、处理器周期或速度、功耗（见下文）、处理器外围设</li>
</ul>
<h4 id="3-Size-and-weight-limits-尺寸和重量限制"><a href="#3-Size-and-weight-limits-尺寸和重量限制" class="headerlink" title="(3) Size and weight limits 尺寸和重量限制"></a>(3) Size and weight limits 尺寸和重量限制</h4><ul>
<li>Mobile (aviation, automotive) and portable (e.g. handheld) systems  移动式（航空、汽车）和便携式（例如手持式）系统</li>
</ul>
<h4 id="4-Power-and-energy-limits-功率和能量限制"><a href="#4-Power-and-energy-limits-功率和能量限制" class="headerlink" title="(4) Power and energy limits 功率和能量限制"></a>(4) Power and energy limits 功率和能量限制</h4><ul>
<li>Battery capacity  电池容量</li>
</ul>
<h4 id="5-Environment-环境"><a href="#5-Environment-环境" class="headerlink" title="(5) Environment 环境"></a>(5) Environment 环境</h4><ul>
<li>Temperatures may range from -40°C to 125°C, or even more  温度可能从-40°C到125°C，甚至更高</li>
<li>Cooling limits   冷却限制</li>
</ul>
<h3 id="8-Impact-of-Constraints-限制的影响"><a href="#8-Impact-of-Constraints-限制的影响" class="headerlink" title="8. Impact of Constraints    限制的影响"></a>8. Impact of Constraints    限制的影响</h3><h4 id="1-Microcontrollers-rather-than-microprocessors-微控制器"><a href="#1-Microcontrollers-rather-than-microprocessors-微控制器" class="headerlink" title="(1) Microcontrollers (rather than microprocessors)  微控制器"></a>(1) Microcontrollers (rather than microprocessors)  微控制器</h4><ul>
<li>Peripherals are included to interface with other devices, respond efficiently. 微控制器包含外围设备，用于与其他设备进行接口，并能够高效响应</li>
<li><strong>On-chip RAM, ROM</strong> reduce circuit board complexity and cost. 嵌入了片上RAM和ROM，减少了电路板的复杂性和成本</li>
</ul>
<h4 id="2-Programming-language"><a href="#2-Programming-language" class="headerlink" title="(2) Programming language"></a>(2) Programming language</h4><ul>
<li>Programmed in <strong>C</strong> rather than Java (smaller and faster code, so less expensive MCU)  使用C语言而不是Java语言（代码更小、更快，因此MCU成本更低）</li>
<li>Some performance-critical code may be in <strong>assembly</strong> <strong>language </strong>一些性能关键的代码可能会用汇编语言编写，以提高效率</li>
</ul>
<h4 id="3-Operating-system-OS"><a href="#3-Operating-system-OS" class="headerlink" title="(3) Operating system (OS)"></a>(3) Operating system (OS)</h4><ul>
<li>Typically no OS, but instead <strong>simple scheduler</strong> (or even just interrupts + main code (foreground/background system)  通常不使用操作系统，而是使用简单的调度器（甚至只是中断 + 主代码（前台/后台系统））</li>
<li>If OS is used, likely to be a Real-Time OS with a small code size  如果使用操作系统，可能会使用具有较小代码大小的实时操作系统</li>
</ul>
<h3 id="9-总结-补充"><a href="#9-总结-补充" class="headerlink" title="9. 总结+补充"></a>9. 总结+补充</h3><ul>
<li>定义</li>
<li>三个属性：交互+并发+故障</li>
<li>3个优点：性能+成本+可靠</li>
<li>4类应用：闭环控制（维持定值）+顺序（步骤）+信号处理+通信</li>
<li>5点限制：成本+算力+尺寸+功率+环境</li>
<li><strong>(Micro)processor</strong> is the heart of modern embedded systems, and it dominates the <strong>design cycle</strong> of the system.（微）处理器是现代嵌入式系统的核心，它主导着系统的设计周期。</li>
<li>Identify <strong>constraints</strong> of your system is a key first step in designing a good embedded systems.识别系统的约束条件是设计一个良好的嵌入式系统的关键的第一步。</li>
</ul>
<h2 id="03-Creating-System-Architecture-for-Embedded-Systems"><a href="#03-Creating-System-Architecture-for-Embedded-Systems" class="headerlink" title="03  Creating System Architecture for Embedded Systems"></a>03  Creating System Architecture for Embedded Systems</h2><h3 id="1-Product-Specification-for-Embedded-Systems-嵌入式系统的产品规范"><a href="#1-Product-Specification-for-Embedded-Systems-嵌入式系统的产品规范" class="headerlink" title="1. Product Specification for Embedded Systems  嵌入式系统的产品规范"></a>1. Product Specification for Embedded Systems  嵌入式系统的产品规范</h3><ul>
<li>A product definition is seldom fixed at the start, so you may go round and round to hammer out ideas. 产品定义很少在一开始就固定，所以你可以不断地提出想法。</li>
<li>A good design is created by starting with an OK design and then improving on it, ideally before you start implementing it.  一个好的设计是从一个OK设计开始，然后改进它，理想情况下是在你开始实现它之前。</li>
<li><strong>Creating a system architecture diagram</strong> is a good way to view the system and start designing the software. 创建系统体系结构图是查看系统并开始设计软件的一种好方法</li>
<li>提示: <strong>software strongly depends on hardware</strong>; unstable hardware leaves the software looking buggy and unreliable.软件强烈地依赖于硬件；不稳定的硬件会让软件看起来有漏洞和不可靠</li>
</ul>
<h3 id="2-Use-of-Diagrams"><a href="#2-Use-of-Diagrams" class="headerlink" title="2. Use of Diagrams"></a>2. Use of Diagrams</h3><ul>
<li><p>Consider formulating two architecture diagrams: <strong>local (code level), global (whole product)</strong>. 考虑制定两种体系结构图：局部（代码级）、全局（整个产品）</p>
</li>
<li><p>Focus on the <strong>information</strong>, not the drawing method. 集中在信息，而不是绘画方式</p>
</li>
</ul>
<h4 id="1-The-Context-Diagram"><a href="#1-The-Context-Diagram" class="headerlink" title="(1) The Context Diagram"></a>(1) <font color=red>The Context Diagram</font></h4><ul>
<li>An <strong>overview</strong> of how your system fits into the world at large and used by your “customers”  概述您的系统如何适应整个世界，并被您的“客户”使用</li>
</ul>
<p><img src="/img/typora-user-images/image-20240311215136049.png" alt="image-20240311215136049"></p>
<h4 id="2-The-Block-Diagram"><a href="#2-The-Block-Diagram" class="headerlink" title="(2) The Block Diagram"></a>(2) <font color=red>The Block Diagram</font></h4><ul>
<li>Consider the <strong>physical</strong> elements of the system  考虑系统的物理元素<ul>
<li>For example, each chip attached to the processor is an object. You can also think of the wires that connect the chip to the processor (the communication methods) as another set of objects.  例如，连接到处理器的每个芯片都是个对象，连接芯片和处理器之间的线（通信方法）也可以作为另外一组对象。</li>
</ul>
</li>
<li><p>Start by drawing these as <strong>boxes</strong> where the <strong>processor</strong> is in the <strong>center</strong> with communication objects, and each <strong>external component</strong> is attached to a <strong>communication object.</strong>  将芯片画在中心，通信对象画在处理器里，然后将其他外设一个一个地连接到这些对象上</p>
</li>
<li><p><img src="/img/typora-user-images/image-20240311220548634.png" alt="image-20240311220548634" style="zoom:80%;" /></p>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240311220616293.png" alt="image-20240311220616293"></p>
<ul>
<li>举个例子，这里我要介绍一种称为闪存的存储器。大多数闪存芯片都通过SPI总线通信（SPI是一种串行通信）。它通常用做片外部存储器，因为大部分处理器都无法通过SPI接口在闪存上执行代码。图左半部分的原理图展示了如何将闪存通过SPI连接到处理器。</li>
<li>在我们的<strong>软件框图</strong>中，我们将闪存作为外设（处理器外面的一个方框），<strong>在处理器内部增加一个表示SPI的方框</strong>，这意味着我们需要写一些驱动SPI的代码。这个时候，我们的软件框图看起来和硬件原理图很相似，但随着我们逐渐加入更多的软件组件，就会慢慢变得不同了。</li>
<li><p>下一步在处理器内部增加一个表示闪存的方框，提示我们需要写一些驱动闪存的代码。将通信方式和外设分离开来是有益的</p>
</li>
<li><p>Adding Higher-level Funtionality   增加一些高层功能</p>
<ul>
<li>下一个阶段就是增加一些高层功能。每个外设芯片是做什么用的？如果每个芯片只有一个功能，那就简单了。</li>
<li>Example: if our flash is used to store bitmaps to put on a screen, we can put a box on the architecture to represent the display assets   例如，如果将闪存用做存储位图图片以便在屏幕上显示，我们就可以在架构框图上画一个方框表示显示数据。</li>
<li>这时候没有片外组件，因此这个方框置于处理器内部。我们还需要画上一些方框来表示屏幕与屏幕的通信方式，和另一个方框表示将基于闪存的显示数据转换到屏幕。这个时候，多画些功能框比少画好，后面我们会合并它们。可以将能够想到的其他一些软件构件加到框图上，如数据库、缓存系统、命令处理程序、算法、状态机等。这个时候，可能不是很确切地知道自己是否需要这些，但请试着将从硬件到产品功能的所有东西都表达在框图上，如下图所示。</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240311221019014.png" alt="image-20240311221019014"></p>
<h4 id="3-Organigram"><a href="#3-Organigram" class="headerlink" title="(3) Organigram"></a>(3) <font color=red>Organigram</font></h4><p><img src="/img/typora-user-images/image-20240311221615823.png" alt="image-20240311221615823" style="zoom:80%;" />                               <img src="/img/typora-user-images/image-20240311222023231.png" alt="image-20240311222023231" style="zoom:80%;" /></p>
<ul>
<li>左图中展示了各个相互独立的组件，以及组件之间的调用关系。整个系统就是一个分层的结构，Main是最高层的对象。如果已经知道算法将要如何使用每个组件，就可以在下一个层次画上算法相关的对象。如果认为它们不会再变化，那么就可以从产品相关的特征开始，逐步分解到我们已经知道的对象，将最复杂的放在顶层。然后，画上被高层对象使用的低层次对象。<strong>例如，我们的SPI对象会被闪存对象调用，闪存对象又会被显示对象调用</strong>，依此类推。还可以加上之前没有考虑到的对象或者组件。同时，还需要决定是否将这些组件增加到架构框图上（很有可能）。</li>
<li>Consider the whole system as a hierarchy with main at the highest level, then work out discrete components and which ones call others. 将整个系统视为一个具有最高层次的层次结构，然后计算出离散组件，哪些组件称之为其他组件。</li>
<li>虽然，我们总希望一个外设完成一个特定的功能（比如，闪存中的显示资源），但系统的约束（成本、速度等）通常不会支持这样做。因此，我们往往会给一个外设上赋予了多个但并不特别兼容的功能。在左图可以看到文本组件和图像组件共享闪存驱动程序组件及其下面的SPI驱动程序组件。通常，这种共享是必要的，但对设计来说，这是个红灯，<strong>因为需要特别当心以避免资源的冲突，并确保资源在需要的时候可用</strong>。幸运的是，左图中给出了渲染代码组件，它控制这两个组件，并能够确保在任何一个时刻只有一个组件（文本或者图像）可用，因此在它们之间就不大可能再有冲突发生。</li>
<li>比如，设计团队决定系统需要每个单元有一个序列号。这个序列号会在生产的时候烧录进去并在需要的时候提供。我们可以增加另外一个存储器芯片作为外设，但这会增加成本、电路板的复杂度和软件的复杂度。<strong>我们已有的闪存有足够的空间存储这个序列号，因此只需要增加软件的复杂度</strong>。在右图中，我们通过闪存打印序列号，而这个闪存之前是用于显示组件。如果日志子系统需要从显示组件异步获取序列号（比如，我们有两个线程或者显示组件使用中断），软件需要避免冲突和由此带来的系统崩溃。</li>
</ul>
<p>注意：</p>
<ul>
<li>Careful with sharing as you’ll need to take special care to avoid contention around the resource and make sure it is available when needed  小心共享，因为需要特别当心以避免资源的冲突，并确保资源在需要的时候可用。</li>
<li><p>For instance, our SPI object is used by our flash object, which is used by our display assets object, and so on   例如，我们的SPI对象被我们的flash对象使用，它被我们的显示资产对象使用，等等。</p>
</li>
<li><p>Suppose that we now need each unit to have a serial number, we could add another memory chip as a component.  假设我们现在需要每个单元都有一个序列号，我们可以添加另一个内存芯片作为一个组件。</p>
<ul>
<li>But we can also approach a solution with the same hardware:  但我们也可以用相同的硬件找到一个解决方案</li>
<li>Is the flash large enough to fit the serial number? If so, only software complexity has to increase.    flash是否大到足以适合序列号？如果是这样，那么只有软件的复杂性才必须增加。</li>
</ul>
</li>
</ul>
<h3 id="3-Design-for-change"><a href="#3-Design-for-change" class="headerlink" title="3. Design for change"></a>3. Design for change</h3><h4 id="With-your-drafts-of-the-diagrams-ask-yourself-the-question-what-is-going-to-change"><a href="#With-your-drafts-of-the-diagrams-ask-yourself-the-question-what-is-going-to-change" class="headerlink" title="With your drafts of the diagrams, ask yourself the question: what is going to change?"></a>With your drafts of the diagrams, ask yourself the question: <strong>what is going to change?</strong></h4><ul>
<li><p><strong>Encapsulate Modules  封装模块</strong></p>
<ul>
<li><p>我们要设计不同模块之间的接口，而这些接口不依赖于其内部是如何实现的（这就是封装）。</p>
</li>
<li><p>In the organigram, look for objects that are used by only one other object. Are these both fixed?  在组织图中，查找只被另一个对象使用的对象。这些都是固定的吗？</p>
</li>
<li><p>e.g. the LCD is attached to the parallel interface.  例如，LCD连接到并行接口。在每张图中，这都是比较简单的，因为</p>
<p>没有任何额外的依赖关系，同是也没有其他子系统需要访问并行接口。因此，不需要暴露并行接口，可以将它封装在LCD模块内部。</p>
</li>
</ul>
</li>
<li><p><strong>Delegation of Tasks   任务的委托</strong></p>
<ul>
<li>Which parts of the system can be broken off into separate, describable pieces that someone else can implement?  系统的哪些部分可以分解成单独的、可描述的部分，其他人可以实现呢？<ul>
<li>e.g. encourage clear division of labours.  例如，鼓励明确的劳动分工</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-Driver-Interface-驱动程序接口"><a href="#4-Driver-Interface-驱动程序接口" class="headerlink" title="4. Driver Interface 驱动程序接口"></a>4. Driver Interface 驱动程序接口</h3><ul>
<li>Many drivers in embedded systems are based on the POSIX API used to call devices in Unix systems.  嵌入式系统中的许多驱动程序都是基于用于调用Unix系统中的设备的POSIX API。</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>open(), init()</strong></td>
<td>Opens the driver for use     打开驱动程序以供使用</td>
</tr>
<tr>
<td style="text-align:center"><strong>close(), end()</strong></td>
<td>Cleans up the driver after use.   使用后清理驱动程序。</td>
</tr>
<tr>
<td style="text-align:center"><strong>read(), get(), recv()</strong></td>
<td>Reads data from the device.   从设备中读取数据。</td>
</tr>
<tr>
<td style="text-align:center"><strong>write(), put(), send()</strong></td>
<td>Sends data to the device.  向设备发送数据。</td>
</tr>
<tr>
<td style="text-align:center"><strong>ioctl(), setup(),config()</strong></td>
<td>Stands for input/output (I/O) control and handles the features not covered by the other parts of the interface.   代表输入/输出（I/O）控制，并处理接口的其他部分未覆盖的功能。</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>Possible namings for the driver interface for a driver to SPI  从驱动程序到SPI的驱动程序接口的可能名称</li>
</ul>
<p><img src="/img/typora-user-images/image-20240312142647588.png" alt="image-20240312142647588"></p>
<h3 id="5-总结-补充"><a href="#5-总结-补充" class="headerlink" title="5.  总结+补充"></a>5.  总结+补充</h3><ul>
<li><p><strong>No design will remain static.</strong> 任何设计都不会保持静态状态。</p>
<ul>
<li>The goal of design is to understand things from the system perspective. 设计的目标是从系统的角度来理解事物。</li>
</ul>
</li>
<li><p>You may not need to update your diagrams with every change. It is all about <strong>communications</strong>.  您可能不需要在每次更改时都要更新图表。这一切都是关于通信的</p>
</li>
<li><p><strong>Context diagram</strong>: what you’re supposed to do   上下文图：你应该做些什么</p>
</li>
<li><p><strong>Block diagram</strong>: pieces of HW and SW     块图：硬件和软件片</p>
</li>
<li><p><strong>Organigram</strong>: shows where control flows and possible conflicts as multiple subsystems try to access the same resources.   组织图：显示当多个子系统试图访问相同资源时的控制流和可能的冲突</p>
</li>
<li><p>驱动接口</p>
</li>
</ul>
<h2 id="04-Environmental-and-Societal-Impact-of-Electrical-and-Electronic-Equipments"><a href="#04-Environmental-and-Societal-Impact-of-Electrical-and-Electronic-Equipments" class="headerlink" title="04 Environmental and Societal Impact of Electrical and Electronic Equipments"></a>04 Environmental and Societal Impact of Electrical and Electronic Equipments</h2><h3 id="1-Waste-Electrical-and-Electronic-Equipment-recycling-WEEE"><a href="#1-Waste-Electrical-and-Electronic-Equipment-recycling-WEEE" class="headerlink" title="1. Waste Electrical and Electronic Equipment recycling (WEEE)"></a>1. Waste Electrical and Electronic Equipment recycling (WEEE)</h3><ul>
<li>WEEE includes most products that have a plug or need a battery.   WEEE包括了大多数有插头或需要电池的产品。<ul>
<li>Household appliances (~ 40%) – e.g. fridges, cookers</li>
<li>IT and telecommunications equipment – e.g. personal computers, telephones</li>
<li>Consumer equipment – e.g. radios, televisions</li>
<li>Toys, leisure and sports equipment – e.g.  games consoles and running machines</li>
</ul>
</li>
</ul>
<h3 id="2-United-Nations-UN-SDG-12"><a href="#2-United-Nations-UN-SDG-12" class="headerlink" title="2. United Nations (UN): SDG 12"></a>2. United Nations (UN): SDG 12</h3><ul>
<li>SDG = Sustainable Development Goals. SDG #12 is <strong>responsible consumpton and production</strong>.  可持续发展目标，SDG#12负责消费和生产</li>
<li><p>How can I help as a <strong>business</strong>?</p>
<ul>
<li>To find new solutions that enable <strong>sustainable consumption and production patterns</strong>. 找到能够实现可持续消费和生产模式的新解决方案。</li>
<li><strong>Innovation and design solutions</strong> can both enable and inspire individuals to lead more sustainable lifestyles, reducing impacts and improving well-being.  创新和设计解决方案既能使和激励个人过上更可持续的生活方式，也能减少影响和改善福祉。</li>
</ul>
</li>
<li><p>How can I help as a <strong>consumer</strong>?</p>
<ul>
<li><strong>Reducing</strong> your waste  减少浪费</li>
<li><strong>Being thoughtful</strong> and making informed purchases about what you buy and choosing a <strong>sustainable option</strong> whenever possible.  深思熟虑，慎重购买，尽可能选择可持续的选择。</li>
</ul>
</li>
</ul>
<h2 id="05-ARM-Cortex-M4-Processor-Architecture"><a href="#05-ARM-Cortex-M4-Processor-Architecture" class="headerlink" title="05 ARM Cortex-M4 Processor Architecture"></a>05 ARM Cortex-M4 Processor Architecture</h2><h3 id="1-Embedded-Processors"><a href="#1-Embedded-Processors" class="headerlink" title="1. Embedded Processors"></a>1. Embedded Processors</h3><p>As predicted by Moore’s law, the use of <strong>microprocessors (μP)</strong> has extended from personal general purpose computers to a lot of daily-life applications like digital cameras, TVs, cars, etc.  正如摩尔定律所预测的那样，微处理器（μP）的使用已经从个人通用计算机扩展到许多日常生活中的应用程序，如数码相机、电视、汽车等。</p>
<ul>
<li>A by-product of μP was <font color=red><strong>microcontroller</strong></font>, which is an integrated computer system, for a single or several designated task.      μP的一个副产品是微控制器，这是一个集成的计算机系统，用于一个单一或多个指定的任务</li>
<li>We may use the term <font color=red><strong>processor(s)</strong></font> interchangeably for <strong>microprocessors or microcontrollers</strong> in embedded systems   在嵌入式系统中，我们可以将处理器的术语互换地用于微处理器或微控制器。</li>
</ul>
<p><strong>Micro-“Computer” is everywhere now!</strong>   “微-‘计算机’现在无处不在！”</p>
<h3 id="2-Stored-Program-Concept"><a href="#2-Stored-Program-Concept" class="headerlink" title="2. Stored Program Concept"></a>2. Stored Program Concept</h3><h4 id="1-computer"><a href="#1-computer" class="headerlink" title="(1) computer"></a>(1) computer</h4><ul>
<li><p><strong>What is a computer?</strong> </p>
<ul>
<li>It is a <strong>machine</strong> that can <strong>perform a list of simple calculations</strong>, which we call <strong>algorithms</strong>. 它是一种可以执行一系列简单计算的机器，我们称之为算法。</li>
</ul>
</li>
<li><p>A computer …</p>
<ul>
<li>performs a sequence of calculations;  执行一系列计算；</li>
<li>makes decisions based on the results of calculations;  根据计算结果做出决定；</li>
<li>and repeats the sequence if wanted.   如果需要的话，重复这个序列。</li>
</ul>
</li>
<li><font color=blue>**Computer architecture**:  the way that the three key boxes (CPU, memory, I/O) are arranged and connected.</font>  

<p>计算机体系结构（Computer architecture）是指CPU（中央处理器）、内存（存储器）、I/O（输入/输出设备）这三个关键组件的排列和连接方式。</p>
<p><img src="/img/typora-user-images/image-20240312162830074.png" alt="image-20240312162830074" style="zoom: 50%;" /></p>
</li>
</ul>
<ol>
<li><p><strong>中央处理单元（CPU）</strong>：    CPU是计算机的核心部分，负责执行程序的指令和处理数据。它通常分为两个主要部分：</p>
<ul>
<li><strong>程序控制单元</strong>：负责从主内存获取指令，解码和执行它们。</li>
<li><strong>算术逻辑单元（ALU）</strong>：执行所有的算术和逻辑运算。</li>
</ul>
</li>
<li><p><strong>主内存</strong>：</p>
<ul>
<li>主内存存储程序的指令和CPU处理的数据。CPU从主内存中读取指令和数据，并将处理后的数据写回主内存。</li>
</ul>
</li>
<li><p><strong>输入/输出（I/O）</strong>：</p>
<ul>
<li>输入/输出设备用于与外部世界交互，例如键盘、鼠标、显示器和外部存储设备。CPU通过输入/输出接口与这些设备进行数据交换。</li>
</ul>
</li>
<li><p><strong>数据流动</strong>：</p>
<ul>
<li>程序控制单元从主内存中读取指令，这些指令指示CPU如何进行数据处理。</li>
<li>算术逻辑单元根据这些指令处理数据，并可能将结果存回主内存。</li>
<li>输入/输出操作可能涉及从输入设备读取数据到主内存，或将数据从主内存发送到输出设备。</li>
</ul>
</li>
<li><p><strong>连接线</strong>：</p>
<ul>
<li>实线表示数据和指令的直接流动，例如从主内存到CPU。</li>
<li>虚线表示可能的数据和指令流动，如从输入/输出设备到主内存和CPU。</li>
</ul>
</li>
</ol>
<h4 id="2-Von-Neumann-Architecture"><a href="#2-Von-Neumann-Architecture" class="headerlink" title="(2) Von Neumann Architecture"></a>(2) Von Neumann Architecture</h4><p><img src="/img/typora-user-images/image-20240312163347218.png" alt="image-20240312163347218" style="zoom:50%;" /></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Component</strong></th>
<th style="text-align:center"><strong>Functions</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Central Processing Unit (CPU)</td>
<td style="text-align:center">controls the system and performs calculations   控制系统并执行计算</td>
</tr>
<tr>
<td style="text-align:center">Main Memory</td>
<td style="text-align:center">stores both instructions and data   同时存储指令和数据</td>
</tr>
<tr>
<td style="text-align:center">Peripheral Input/Output (I/O)</td>
<td style="text-align:center">allows data to be input to system,    allows results to be output from system <br />允许将数据输入到系统，也允许从系统输出结果</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><strong>控制总线</strong>：用于CPU向其他组件发送控制信号，如读取、写入命令。</li>
<li><strong>数据总线</strong>：用于在CPU、内存和外设之间传输数据。</li>
<li><strong>地址总线</strong>：用于指定数据应被发送到或从哪个确切的物理地址读取。<ul>
<li>CPU通过地址总线指定它想要访问的内存位置或特定的I/O设备。每个传送的地址都告诉系统，数据将被读取或写入的具体位置。</li>
<li>内存和I/O设备的角色主要是响应来自CPU的地址信号，并据此执行相应的数据传输任务。他们不会主动在地址总线上发送地址，而是被动地接收来自CPU的指令和数据。</li>
</ul>
</li>
</ul>
<h4 id="3-Fetch-Decode-Execute-Cycle"><a href="#3-Fetch-Decode-Execute-Cycle" class="headerlink" title="(3) Fetch-Decode-Execute Cycle"></a>(3) Fetch-Decode-Execute Cycle</h4><ul>
<li><p>The CPU is a <strong>finite state machine (FSM)</strong> which runs the <strong>programs stored in the memory</strong> by the user. </p>
<p>CPU是一个有限状态机（FSM），它运行由用户存储在内存中的程序。</p>
</li>
<li><p>It repeatedly performs three operations:</p>
<ul>
<li><strong>Fetch</strong> – <strong>retrieve</strong> an instruction from memory  从内存中检索指令</li>
<li><strong>Decode</strong> – <strong>interpret</strong> the instruction  解释指令</li>
<li><strong>Execute</strong> – <strong>control</strong> appropriate hardware to <strong>carry out</strong> the instruction  控制适当的硬件来执行该指令</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240312165539911.png" alt="image-20240312165539911" style="zoom: 50%;" /></p>
<h4 id="4-Harvard-Architecture-哈佛体系结构"><a href="#4-Harvard-Architecture-哈佛体系结构" class="headerlink" title="(4) Harvard Architecture   哈佛体系结构"></a>(4) Harvard Architecture   哈佛体系结构</h4><ul>
<li>Separate instruction and data memories each with <strong>dedicated bus</strong>  指令存储器和数据存储器是分开的，各带有自己的专用总线<ul>
<li>这种设计可以提高数据吞吐量，因为处理器可以同时从指令存储器读取指令和从数据存储器读取或写入数据，不会发生数据和指令的竞争。</li>
</ul>
</li>
</ul>
<p>​                                                       <img src="/img/typora-user-images/image-20240312164751606.png" alt="image-20240312164751606" style="zoom: 50%;" /></p>
<ol>
<li><p><strong>算术逻辑单元 (Arithmetic &amp; Logic Unit)</strong>：执行所有的算术运算（如加法、减法等）和逻辑运算（如与、或等）。</p>
</li>
<li><p><strong>指令存储器 (Instruction Memory)</strong>：存储计算机程序的指令。这些指令会被取出来供处理器执行。</p>
</li>
<li><p><strong>数据存储器 (Data Memory)</strong>：存储程序运行过程中需要的数据和操作结果。</p>
</li>
<li><p><strong>程序控制单元 (Program Control)</strong>：控制指令的获取、解码和执行，并管理程序的执行流程。</p>
</li>
<li><p><strong>外围输入/输出 (Peripheral I/O)</strong>：处理与外部设备（如键盘、显示器等）的交互。</p>
</li>
</ol>
<h4 id="5-Von-Neumann体系结构和Harvard体系结构对比："><a href="#5-Von-Neumann体系结构和Harvard体系结构对比：" class="headerlink" title="(5) Von Neumann体系结构和Harvard体系结构对比："></a>(5) Von Neumann体系结构和Harvard体系结构对比：</h4><div class="table-container">
<table>
<thead>
<tr>
<th>特征</th>
<th>冯·诺伊曼体系结构</th>
<th>哈佛体系结构</th>
</tr>
</thead>
<tbody>
<tr>
<td>指令和数据存储</td>
<td>存储在同一存储器中</td>
<td>存储在不同的存储器中</td>
</tr>
<tr>
<td>存储器访问</td>
<td>单总线用于指令和数据的传输</td>
<td>分开的总线用于指令和数据的传输</td>
</tr>
<tr>
<td>数据传输</td>
<td>指令和数据顺序传输</td>
<td>指令和数据并行传输</td>
</tr>
<tr>
<td>存储器修改</td>
<td>可以在执行期间修改程序和数据</td>
<td>指令存储器内容在执行期间不会修改</td>
</tr>
<tr>
<td>适用领域</td>
<td>通用计算机系统</td>
<td>嵌入式系统、数字信号处理器</td>
</tr>
<tr>
<td>性能优劣</td>
<td>受限于单一总线的带宽和顺序传输</td>
<td>并行传输可提高性能</td>
</tr>
<tr>
<td>稳定性</td>
<td>存在指令和数据竞争的可能性</td>
<td>指令存储稳定性高</td>
</tr>
<tr>
<td>成本和复杂性</td>
<td>通常较低，较简单</td>
<td>较高，较复杂</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-Instructions"><a href="#3-Instructions" class="headerlink" title="3. Instructions"></a>3. Instructions</h3><h4 id="1-语言"><a href="#1-语言" class="headerlink" title="(1) 语言"></a>(1) 语言</h4><p><strong>To command the computer’s hardware, one must</strong> <strong>speak its language.</strong>    要控制计算机的硬件，就必须说它的语言。</p>
<ul>
<li>定义：<strong>The words of a computer’s language</strong> are called <strong>instructions</strong>, and its <strong>vocabulary</strong> is called an <strong>instruction set</strong>.  计算机语言中的单词称为指令，它的词汇被称为指令集。</li>
<li>It is interesting that there are <strong>different dialects</strong> of computer languages. It is easy to pick up others if you once learn it.  有趣的是，计算机语言有不同的方言。如果你一旦学会了，就很容易找到别人。</li>
<li>The <strong>functionalities</strong> of a computer are <strong>specified</strong> by its <strong>instruction set</strong>.  计算机的功能是由其指令集来指定的</li>
</ul>
<h4 id="2-Operands-amp-Registers-操作数和寄存器"><a href="#2-Operands-amp-Registers-操作数和寄存器" class="headerlink" title="(2) Operands &amp; Registers 操作数和寄存器"></a>(2) Operands &amp; Registers 操作数和寄存器</h4><ul>
<li>The operands of instructions are restricted. They must be from a <strong>limited number of special locations</strong> in HW called <strong>registers</strong>. 指令的操作数受到限制。它们必须来自硬件中有限数量的特殊位置叫做寄存器。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD r3, r1, r2 ;      r3 = r1 + r2 (C style)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>In this example, all r1, r2 and r3 are registers.</p>
</li>
<li><p>In writing instructions, we often need to <strong>assign variables to registers</strong>. You should note that some registers are dedicated for a <strong>special purpose</strong>,  e.g. <strong>r15</strong> is the program counter in ARM.  在编写指令时，我们经常需要为寄存器分配变量。您应该注意到，有些寄存器是专门用于特殊目的的，例如，r15是ARM中的程序计数器</p>
</li>
</ul>
<p><strong>Q: Why is the number of registers small and limited? </strong>  为什么寄存器的数量很小而且有限？</p>
<p>A: <strong>Smaller is faster</strong>. A very large number of registers may increase the clock cycle time.   更小的速度更快。大量的寄存器可能会增加时钟周期的时间。</p>
<h4 id="3-Binary-Representation"><a href="#3-Binary-Representation" class="headerlink" title="(3) Binary Representation"></a>(3) Binary Representation</h4><ul>
<li>If arithmetic operations occur <strong>only on registers</strong>, then it should be allowed to <strong>transfer data between registers</strong>.   如果算术运算只发生在寄存器上，那么应该允许它在寄存器之间传输数据。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MOV r2, r1 ;    r2 = r1 (C style)</span><br></pre></td></tr></table></figure>
<ul>
<li>instruct a computer to copy/move the value stored in register r1 to the register r2.  指示计算机将存储在寄存器r1中的值复制/移动到寄存器r2中。</li>
</ul>
<p><img src="/img/typora-user-images/image-20240312221511121.png" alt="image-20240312221511121" style="zoom: 50%;" /></p>
<ul>
<li><p>To make the processor executes our instruction, an <strong>assembler</strong> will translate our <strong>symbolic notation into machine code</strong>:   为了使处理器执行我们的指令，汇编程序将把我们的符号符号转换为机器代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MOV r2, r1 -&gt; <span class="number">1110</span> <span class="number">0001</span> <span class="number">1010</span> <span class="number">0000</span> <span class="number">0010</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0001</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="4-Compilation-and-Assembling-编译和组装"><a href="#4-Compilation-and-Assembling-编译和组装" class="headerlink" title="(4) Compilation and Assembling 编译和组装"></a>(4) Compilation and Assembling 编译和组装</h4><ul>
<li>In embedded system development, we <strong>(cross-)compile</strong> a C program for the target processor. Then the <strong>assembler</strong> translates the <strong>instructions into the machine codes</strong>.  在嵌入式系统开发中，我们（交叉）为目标处理器编译了一个C程序。然后，汇编程序会将这些指令转换成机器代码。</li>
</ul>
<p><img src="/img/typora-user-images/image-20240312222004341.png" alt="image-20240312222004341" style="zoom: 50%;" /></p>
<h3 id="4-ARM"><a href="#4-ARM" class="headerlink" title="4. ARM"></a>4. ARM</h3><h4 id="1-ARM-Architecture"><a href="#1-ARM-Architecture" class="headerlink" title="(1) ARM Architecture"></a>(1) ARM Architecture</h4><ul>
<li>ARM architecture is a family of <strong>RISC-based processor</strong> architectures   ARM体系结构是一类基于RISC的处理器体系结构<ul>
<li>Advanced <strong>R</strong>educed <strong>I</strong>nstruction <strong>S</strong>et <strong>C</strong>omputer Machine (RISC)    高级简化指令集计算机机器</li>
<li>Well-known for its <strong>power efficiency</strong>;  以其功耗效率而闻名</li>
<li>Hence widely used in many embedded systems and mobile devices, such as smartphones and tablets  因此被广泛应用于许多嵌入式系统和移动设备，如智能手机和平板电脑</li>
<li>Designed and licensed to a wide eco-system by ARM Holdings company</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240317174744758.png" alt="image-20240317174744758"></p>
<h4 id="2-ARM-Cortex-M-Series"><a href="#2-ARM-Cortex-M-Series" class="headerlink" title="(2) ARM Cortex-M Series"></a>(2) ARM Cortex-M Series</h4><ul>
<li>Cortex-M0, M0+, M1, M3, M4.</li>
<li>特点<ul>
<li>Energy-efficiency: <strong>lower energy cost, longer battery life</strong> </li>
<li>Smaller code: lower silicon costs  较小的代码：较低的硅成本</li>
<li>Ease of use: faster software development and reuse  易用性：更快的软件开发和重用</li>
<li>Embedded applications 嵌入式应用</li>
</ul>
</li>
<li>补充：<ul>
<li>ARM architecture describes the <strong>details</strong> of <strong>instruction set, programmer’s model, exception model, and memory map</strong><br>ARM架构描述了指令集、程序员模型、异常模型和内存映射的细节</li>
<li><strong>ARM processor</strong> is the <strong>actual device</strong> that implement ARM architecture.<br>ARM处理器是实现ARM体系结构的实际设备</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240317175620039.png" alt="image-20240317175620039" style="zoom:80%;" /></p>
<h3 id="5-Cortex-M4"><a href="#5-Cortex-M4" class="headerlink" title="5. Cortex-M4"></a>5. Cortex-M4</h3><h4 id="1-Processor-Overview"><a href="#1-Processor-Overview" class="headerlink" title="(1) Processor: Overview"></a>(1) Processor: Overview</h4><ul>
<li><p>Introduced in 2010</p>
</li>
<li><p>Designed for DSP single-cycle MAC optional FPU  用于数字信号处理（DSP）应用，具有单周期乘累加（MAC）指令,可选浮点运算单元（FPU）</p>
</li>
<li><p>1.25 DMIPS/MHz  每兆赫兹1.25亿次浮点运算</p>
</li>
<li><p>Low Power Consumption </p>
</li>
<li><p>Harvard Architecture separate instruction bus and data bus</p>
</li>
<li><p>3-stage pipeline with branch speculation   见(2)</p>
</li>
<li><p>Up to 240 physical interrupts 8 to 256 interupt priority levels 最多240个物理中断8到256个接口优先级</p>
</li>
<li><p>Debug: JTAG, up to 8 breakpoints    调试: JTAG，最多有8个断点</p>
</li>
</ul>
<h4 id="2-3-stage-Pipeline"><a href="#2-3-stage-Pipeline" class="headerlink" title="(2) 3-stage Pipeline"></a>(2) 3-stage Pipeline</h4><ul>
<li><p><strong>Processor core</strong> 处理器核心</p>
<ul>
<li>Contains <strong>internal registers</strong>, the <strong>ALU</strong>, <strong>data path</strong>, and <strong>some control logic</strong>   包含内部寄存器、算术逻辑单元（ALU）、数据路径和一些控制逻辑</li>
<li>Registers include <strong>sixteen 32-bit</strong> registers for both general and special usage 包括16个32位寄存器，用于通用和特殊用途</li>
</ul>
</li>
<li><p>Processor pipeline stages</p>
<ul>
<li>Three-stage pipeline: <strong>fetch, decode, and execution</strong></li>
<li>Some instructions may take <strong>multiple cycles to execute</strong>, in which case the pipeline will be <strong>stalled</strong>  有些指令可能需要多个周期来执行，在这种情况下，管道将被暂停</li>
<li>The pipeline will be <strong>flushed</strong> if a <strong>branch instruction is executed</strong> 如果执行了一个分支指令，则该管道将被刷新</li>
<li><strong>Up to two instructions</strong> can be <strong>fetched</strong> <strong>in one transfer</strong> (16-bit instructions)  在一次传输中最多可以获取两个指令（16位指令）只是针对Fetch！！！</li>
<li>指令在取指之后没有立即解码，是因为流水线阶段的并行处理和资源调度的需要。每条指令在流水线中的不同阶段执行，以确保处理器在每个周期都能有效利用其资源，避免冲突和依赖性问题，从而提高整体效率。或者是等待周期完成后才可以进行。</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240317182925271.png" alt="image-20240317182925271" style="zoom:80%;" /></p>
<h4 id="3-Registers"><a href="#3-Registers" class="headerlink" title="(3) Registers"></a>(3) Registers</h4><p><strong><1> Processor registers</strong>    处理器寄存器</p>
<ul>
<li><p>The <strong>internal registers</strong> are used to <strong>store and process temporary data</strong> within the processor core.  内部寄存器用于存储和处理处理器核心内的临时数据</p>
</li>
<li><p>All registers are inside the <strong>processor core</strong>, hence they can be accessed <strong>quickly</strong>. 所有寄存器都位于处理器核心内部，因此可以<strong>快速访问</strong>。</p>
</li>
<li><p><strong>Load-store architecture</strong> 装载存储体系结构</p>
<ul>
<li>To process memory data, they have to be first <strong><em>loaded</em> <em>from</em> <em>memory to registers</em></strong>, processed inside the <strong><em>processor core</em></strong> <strong><em>using</em></strong> <strong><em>register data only</em></strong>, and then written <strong><em>back to memory</em></strong> if needed.为了处理存储器数据，首先必须将其从存储器加载到寄存器中，在处理器核心内部仅使用寄存器数据进行处理，然后根据需要将其写回存储器。</li>
</ul>
</li>
</ul>
<p><strong><2> Cortex-M4 registers</strong></p>
<ul>
<li>Register bank  寄存器组<ul>
<li>Sixteen 32-bit registers (<strong>thirteen</strong> are used for <strong>general-purpose</strong>);  共有16个32位寄存器（其中13个用于通用目的）</li>
</ul>
</li>
<li>Special registers 特殊寄存器</li>
<li><strong>r15, the Program counter (PC)</strong> stores the beginning address of the current instruction.</li>
</ul>
<p><img src="/img/typora-user-images/image-20240422135143193.png" alt="image-20240422135143193" style="zoom: 50%;" /></p>
<p><img src="/img/typora-user-images/image-20240317235442918.png" alt="image-20240317235442918" style="zoom:80%;" /></p>
<h4 id="4-Memory-Map"><a href="#4-Memory-Map" class="headerlink" title="(4) Memory Map"></a>(4) Memory Map</h4><ul>
<li><p>Cortex-M4 processor has a <strong>4GB</strong> memory space, which is architecturally defined as <strong>a number of regions</strong>   具有4GB的内存空间，按照体系结构定义为多个区域</p>
<ul>
<li>Each region is given for recommended usage 每个区域都可供推荐使用</li>
<li>Easy for software programmer to port between different devices方便软件程序员在不同设备之间进行移植</li>
</ul>
</li>
<li><p>Nevertheless, despite of the default memory map, the actual usage of the <strong>memory map</strong> can be <strong>flexibly defined</strong> by the user.<br>尽管有默认的存储器映射，但实际上用户可以灵活定义存储器映射的使用。</p>
<ul>
<li>except some fixed memory addresses, such as internal private peripheral bus (hardwired) 除了一些固定的存储器地址，如内部私有外设总线（硬连线）</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240318013022021.png" alt="image-20240318013022021" style="zoom: 80%;" /></p>
<ul>
<li><p><strong>Code Region</strong>   <strong>代码区域</strong>   <font color=red>(512MB)</font></p>
<ul>
<li>Primarily used to <strong>store program code</strong>  主要用于存储程序代码</li>
<li>Can also be used as <strong>memory for constant data</strong> 也可用作常量数据的存储器</li>
<li><strong>On-chip memory</strong>, such as on-chip FLASH 嵌入式芯片内存，例如芯片上的FLASH</li>
</ul>
</li>
<li><p><strong>SRAM Region</strong><font color=red>(512MB)</font></p>
<ul>
<li>Primarily used to <strong>store data</strong>, such as heaps and stacks  主要用于存储数据，例如堆和栈</li>
<li>Can also be used for <strong>program code</strong>也可用于程序代码</li>
<li><strong>On-chip memory</strong>; despite its name “SRAM”, the actual device could be SRAM, SDRAM or other types<br>嵌入式芯片内存；尽管其名称为“SRAM”，但实际设备可以是SRAM、SDRAM或其他类型</li>
</ul>
</li>
<li><p><strong>Peripheral Region </strong>     <strong>外设区域</strong><font color=red>(512MB)</font></p>
<ul>
<li>Primarily <strong>used for</strong> <strong>on-chip peripherals</strong> via hardware busses  主要通过硬件总线用于芯片上的外设</li>
</ul>
</li>
<li><p><strong>外部RAM存储区 (External RAM)</strong></p>
<ul>
<li>大小：1GB</li>
<li>主要用于外部存储器，例如外部DDR、FLASH和LCD。</li>
</ul>
</li>
<li><p><strong>外部设备存储区 (External device)</strong></p>
<ul>
<li>大小：1GB</li>
<li>主要用于外部设备，例如SD卡。</li>
</ul>
</li>
<li><p><strong>私有外设总线 (Private Peripheral Bus, PPB)</strong></p>
<ul>
<li>大小：1MB</li>
<li>包含专用外设，例如NVIC（嵌套向量中断控制器）和SCS（系统控制空间）。</li>
</ul>
</li>
<li><p><strong>供应商特定存储区 (Vendor specific Memory)</strong></p>
<ul>
<li>大小：512MB</li>
<li>预留给供应商用于特定用途。</li>
</ul>
</li>
</ul>
<h4 id="5-Program-Image-程序镜像（code-region）"><a href="#5-Program-Image-程序镜像（code-region）" class="headerlink" title="(5)Program Image  程序镜像（code region）"></a>(5)Program Image  程序镜像（code region）</h4><ul>
<li>The program image in Cortex-M4 contains 内容<ul>
<li><strong>Vector table</strong> – includes the <strong>starting addresses of exceptions (vectors)</strong> and the <strong>value of the main stack point (MSP)</strong>;<br><strong>向量表</strong>：包括异常（向量）的起始地址和主堆栈指针（MSP）的值</li>
<li><strong>C start-up routine</strong>;  <strong>C启动例程</strong>：用于初始化程序的C语言启动代码</li>
<li><strong>Program code</strong> – application code and data;  <strong>程序代码</strong>：应用程序代码和数据；</li>
<li><strong>C library code</strong> – program codes for C library functions.  <strong>C库代码</strong>：C库函数的程序代码</li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240318022850175.png" alt="image-20240318022850175" style="zoom:80%;" /></p>
<ul>
<li>After reset, the processor: <strong>(Reset Behaviour)</strong>  在复位后，处理器的行为如下<ul>
<li>First reads the initial MSP value to set up the stack<strong>首先读取初始MSP值以设置堆栈</strong></li>
<li>Then reads the reset vector;  <strong>然后读取复位向量</strong></li>
<li>Branches to the start of the programme execution address (reset handler); <strong>跳转到程序执行地址的开头</strong>（复位处理程序）</li>
<li>Subsequently executes program instructions <strong>随后执行程序指令</strong></li>
</ul>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240318023641982.png" alt="image-20240318023641982" style="zoom: 67%;" /></p>
<h4 id="6-Endianness-字节顺序"><a href="#6-Endianness-字节顺序" class="headerlink" title="(6) Endianness  字节顺序"></a>(6) Endianness  字节顺序</h4><ul>
<li><p>Endian refers to the order of bytes stored in memory 指的是存储在内存中的字节顺序。</p>
<ul>
<li>Little endian: lowest byte of a word-size data is stored in bit 0 to bit 7<br>小端序：一个字（word）的最低字节存储在字节0到字节7。</li>
<li>Big endian: lowest byte of a word-size data is stored in bit 24 to bit 31<br>大端序：一个字的最低字节存储在字节24到字节31。</li>
</ul>
</li>
<li><p>Cortex-M4 supports both little endian (<strong>default</strong>) and big endian.<br>Cortex-M4支持小端序（<strong>默认</strong>）和大端序两种字节序。</p>
</li>
</ul>
<p><img src="/img/typora-user-images/image-20240318025108838.png" alt="image-20240318025108838" style="zoom:80%;" /></p>
<h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><ul>
<li>计算机两种体系结构（图）<ul>
<li>冯诺依曼</li>
<li>哈佛</li>
</ul>
</li>
<li>指令：ADD，MOV，编译转换</li>
<li>Cortex-M4<ul>
<li>三通道：Fetch，Decode，Execute</li>
<li>寄存器：16个32bit: 13通用+SP+LR+PC</li>
<li>存储器映射：4GB，Code+SRAM+Peripherals+…..</li>
<li>程序映像：vector table+C start-up routine+Program code+C library code</li>
</ul>
</li>
<li>字节顺序：<ul>
<li>little endian</li>
<li>big endian</li>
</ul>
</li>
</ul>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/cn/RFID Block2/" data-toggle="tooltip" data-placement="top" title="北邮果园物联RFID第二模块笔记">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/cn/RFID Block1/" data-toggle="tooltip" data-placement="top" title="北邮果园物联RFID第一模块笔记">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      如果您喜欢此博客或发现它对您有用，则欢迎对此发表评论。 也欢迎您共享此博客，以便更多人可以参与。 如果博客中使用的图像侵犯了您的版权，请与作者联系以将其删除。 谢谢 ！
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=北邮果园物联嵌入式系统第一模块笔记&body=Hi,I found this website and thought you might like it http://example.com/cn/嵌入式-Block1/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->

  <!-- gitalk start -->
  <!-- Docs:https://github.com/gitalk/gitalk/blob/master/readme-cn.md -->

  <div id="gitalk-container"></div>

  
    <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.js"></script> -->
    <script src="/js/comment/gitalk.js"></script>
  

  <script>
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: '',
      admin: '',
      id: 'Wed Apr 17 2024 02:34:17 GMT+0800', // Ensure uniqueness and length less than 50
      distractionFreeMode: false, // Facebook-like distraction free mode
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: false,
      language: 'en',
      proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token'
    });
    gitalk.render('gitalk-container');

    var gtFolded = () => {
      setTimeout(function () {
        let markdownBody = document.getElementsByClassName("markdown-body");
        let list = Array.from(markdownBody);
        list.forEach(item => {
          if (item.clientHeight > 250) {
            item.classList.add('gt-comment-body-folded');
            item.style.maxHeight = '250px';
            item.title = 'Click to Expand';
            item.onclick = function () {
              item.classList.remove('gt-comment-body-folded');
              item.style.maxHeight = '';
              item.title = '';
              item.onclick = null;
            };
          }
        })
      }, 800);
    }
  </script>

  <!-- gitalk end -->


<!-- 2. gitment comment -->


<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">目录</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#EBU5477-Embedded-Systems-Block1"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">EBU5477 Embedded Systems Block1</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#02-Introduction-to-Embedded-Systems-Design"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">02 Introduction to Embedded Systems Design</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-What-is-an-Embedded-System"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text">1. What is an Embedded System</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-%E5%AE%9A%E4%B9%89%EF%BC%9A-An-embedded-system-is-a-computerised-system-that-is-purpose-built-for-its-application-%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%98%AF%E4%B8%80%E7%A7%8D%E4%B8%93%E9%97%A8%E4%B8%BA%E5%85%B6%E5%BA%94%E7%94%A8%E8%80%8C%E8%AE%BE%E8%AE%A1%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8C%96%E7%B3%BB%E7%BB%9F%E3%80%82"><span class="toc-nav-number">1.1.1.1.</span> <span class="toc-nav-text">(1) 定义： An embedded system is a computerised system that is purpose-built for its application.  嵌入式系统是一种专门为其应用而设计的计算机化系统。</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-%E7%89%B9%E7%82%B9"><span class="toc-nav-number">1.1.1.2.</span> <span class="toc-nav-text">(2) 特点</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-%E4%BE%8B%E5%AD%90"><span class="toc-nav-number">1.1.1.3.</span> <span class="toc-nav-text">(3) 例子</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Bike-Computer-%E8%87%AA%E8%A1%8C%E8%BD%A6%E8%AE%A1%E7%AE%97%E6%9C%BA"><span class="toc-nav-number">1.1.1.3.1.</span> <span class="toc-nav-text"> Bike Computer 自行车计算机</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Motor-Control-Unit-in-Electric-Vehicles-%E7%94%B5%E5%8A%A8%E6%B1%BD%E8%BD%A6%E4%B8%AD%E7%9A%84%E7%94%B5%E6%9C%BA%E6%8E%A7%E5%88%B6%E5%8D%95%E5%85%83"><span class="toc-nav-number">1.1.1.3.2.</span> <span class="toc-nav-text"> Motor Control Unit in Electric Vehicles 电动汽车中的电机控制单元</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-The-Core-Components-in-Embedded-Systems"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text">2. The Core Components in Embedded Systems</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-Embedded-Systems-Development-%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text">3. Embedded Systems Development 嵌入式系统开发</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-Embedded-Systems-Attributes-%E4%B8%89%E6%9D%A1"><span class="toc-nav-number">1.1.4.</span> <span class="toc-nav-text">4. Embedded Systems: Attributes (三条)</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-Interfacing-with-larger-system-and-environment-lt-font-gt-%E4%B8%8E%E6%9B%B4%E5%A4%A7%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%8E%AF%E5%A2%83%E4%BA%A4%E4%BA%92"><span class="toc-nav-number">1.1.4.1.</span> <span class="toc-nav-text">(1) Interfacing with larger system and environment&lt;&#x2F;font &gt;      与更大的系统和环境交互</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Example-Analog-Sensor-Depth-Gauge-%E6%B7%B1%E5%BA%A6%E8%AE%A1-%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%8B%9F%E5%8E%8B%E5%8A%9B%E4%BC%A0%E6%84%9F%E5%99%A8%E5%92%8C%E6%A8%A1%E6%8B%9F%E8%87%B3%E6%95%B0%E5%AD%97%E8%BD%AC%E6%8D%A2%E5%99%A8%EF%BC%88ADC%EF%BC%89%E6%9D%A5%E6%B5%8B%E9%87%8F%E6%B7%B1%E5%BA%A6-%E6%B2%A1%E5%95%A5%E7%94%A8%E5%90%A7"><span class="toc-nav-number">1.1.4.2.</span> <span class="toc-nav-text">Example: Analog Sensor - Depth Gauge  深度计(使用模拟压力传感器和模拟至数字转换器（ADC）来测量深度)   没啥用吧</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Concurrent-reactive-behaviours-%E5%B9%B6%E5%8F%91%EF%BC%8C%E5%8F%8D%E5%BA%94%E6%80%A7%E8%A1%8C%E4%B8%BA"><span class="toc-nav-number">1.1.4.3.</span> <span class="toc-nav-text">(2) Concurrent, reactive behaviours   并发，反应性行为</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Example-Hardware-amp-Software-Concurrency"><span class="toc-nav-number">1.1.4.4.</span> <span class="toc-nav-text">Example Hardware &amp; Software: Concurrency</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Fault-handling-amp-Diagnostics-%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86%E4%B8%8E%E8%AF%8A%E6%96%AD"><span class="toc-nav-number">1.1.4.5.</span> <span class="toc-nav-text">(3) Fault handling &amp; Diagnostics      故障处理与诊断</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-Embedded-System-Applications-%EF%BC%884%E7%82%B9%EF%BC%89"><span class="toc-nav-number">1.1.5.</span> <span class="toc-nav-text">5. Embedded System: Applications  （4点）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-Closed-loop-control-system-%E9%97%AD%E7%8E%AF%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F"><span class="toc-nav-number">1.1.5.1.</span> <span class="toc-nav-text">(1) Closed-loop control system  闭环控制系统</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Sequencing-%E9%A1%BA%E5%BA%8F%E6%8E%A7%E5%88%B6"><span class="toc-nav-number">1.1.5.2.</span> <span class="toc-nav-text">(2) Sequencing  顺序控制</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Signal-processing-%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86"><span class="toc-nav-number">1.1.5.3.</span> <span class="toc-nav-text">(3) Signal processing  信号处理</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-Communications-and-networking-%E9%80%9A%E4%BF%A1%E4%B8%8E%E7%BD%91%E7%BB%9C"><span class="toc-nav-number">1.1.5.4.</span> <span class="toc-nav-text">(4) Communications and networking  通信与网络</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6-Benefits-of-Embedded-Systems%EF%BC%883%E7%82%B9%EF%BC%89%E6%80%A7%E8%83%BD-%E6%88%90%E6%9C%AC-%E5%8F%AF%E9%9D%A0"><span class="toc-nav-number">1.1.6.</span> <span class="toc-nav-text">6. Benefits of Embedded Systems（3点）性能+成本+可靠</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-Greater-performance-and-efficiency-%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%80%A7%E8%83%BD%E5%92%8C%E6%95%88%E7%8E%87"><span class="toc-nav-number">1.1.6.1.</span> <span class="toc-nav-text">(1) Greater performance and efficiency 更好的性能和效率</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Lower-costs-%E6%9B%B4%E4%BD%8E%E7%9A%84%E6%88%90%E6%9C%AC%EF%BC%88%E7%BB%84%E4%BB%B6-%E5%88%B6%E9%80%A0-%E7%BB%B4%E6%8A%A4%EF%BC%89"><span class="toc-nav-number">1.1.6.2.</span> <span class="toc-nav-text">(2) Lower costs  更低的成本（组件+制造+维护）</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Better-dependability-%E6%9B%B4%E5%A5%BD%E5%9C%B0%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-nav-number">1.1.6.3.</span> <span class="toc-nav-text">(3) Better dependability 更好地可靠性</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-Embedded-Design-Constraints%EF%BC%885%E7%82%B9%EF%BC%89"><span class="toc-nav-number">1.1.7.</span> <span class="toc-nav-text">7. Embedded Design: Constraints（5点）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-Cost-%E6%88%90%E6%9C%AC"><span class="toc-nav-number">1.1.7.1.</span> <span class="toc-nav-text">(1) Cost  成本</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Computation-%E8%AE%A1%E7%AE%97"><span class="toc-nav-number">1.1.7.2.</span> <span class="toc-nav-text">(2) Computation 计算</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Size-and-weight-limits-%E5%B0%BA%E5%AF%B8%E5%92%8C%E9%87%8D%E9%87%8F%E9%99%90%E5%88%B6"><span class="toc-nav-number">1.1.7.3.</span> <span class="toc-nav-text">(3) Size and weight limits 尺寸和重量限制</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-Power-and-energy-limits-%E5%8A%9F%E7%8E%87%E5%92%8C%E8%83%BD%E9%87%8F%E9%99%90%E5%88%B6"><span class="toc-nav-number">1.1.7.4.</span> <span class="toc-nav-text">(4) Power and energy limits 功率和能量限制</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-Environment-%E7%8E%AF%E5%A2%83"><span class="toc-nav-number">1.1.7.5.</span> <span class="toc-nav-text">(5) Environment 环境</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#8-Impact-of-Constraints-%E9%99%90%E5%88%B6%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-nav-number">1.1.8.</span> <span class="toc-nav-text">8. Impact of Constraints    限制的影响</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-Microcontrollers-rather-than-microprocessors-%E5%BE%AE%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-nav-number">1.1.8.1.</span> <span class="toc-nav-text">(1) Microcontrollers (rather than microprocessors)  微控制器</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Programming-language"><span class="toc-nav-number">1.1.8.2.</span> <span class="toc-nav-text">(2) Programming language</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Operating-system-OS"><span class="toc-nav-number">1.1.8.3.</span> <span class="toc-nav-text">(3) Operating system (OS)</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#9-%E6%80%BB%E7%BB%93-%E8%A1%A5%E5%85%85"><span class="toc-nav-number">1.1.9.</span> <span class="toc-nav-text">9. 总结+补充</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#03-Creating-System-Architecture-for-Embedded-Systems"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">03  Creating System Architecture for Embedded Systems</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-Product-Specification-for-Embedded-Systems-%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BA%A7%E5%93%81%E8%A7%84%E8%8C%83"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">1. Product Specification for Embedded Systems  嵌入式系统的产品规范</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-Use-of-Diagrams"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">2. Use of Diagrams</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-The-Context-Diagram"><span class="toc-nav-number">1.2.2.1.</span> <span class="toc-nav-text">(1) The Context Diagram</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-The-Block-Diagram"><span class="toc-nav-number">1.2.2.2.</span> <span class="toc-nav-text">(2) The Block Diagram</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Organigram"><span class="toc-nav-number">1.2.2.3.</span> <span class="toc-nav-text">(3) Organigram</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-Design-for-change"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">3. Design for change</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#With-your-drafts-of-the-diagrams-ask-yourself-the-question-what-is-going-to-change"><span class="toc-nav-number">1.2.3.1.</span> <span class="toc-nav-text">With your drafts of the diagrams, ask yourself the question: what is going to change?</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-Driver-Interface-%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3"><span class="toc-nav-number">1.2.4.</span> <span class="toc-nav-text">4. Driver Interface 驱动程序接口</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-%E6%80%BB%E7%BB%93-%E8%A1%A5%E5%85%85"><span class="toc-nav-number">1.2.5.</span> <span class="toc-nav-text">5.  总结+补充</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#04-Environmental-and-Societal-Impact-of-Electrical-and-Electronic-Equipments"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">04 Environmental and Societal Impact of Electrical and Electronic Equipments</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-Waste-Electrical-and-Electronic-Equipment-recycling-WEEE"><span class="toc-nav-number">1.3.1.</span> <span class="toc-nav-text">1. Waste Electrical and Electronic Equipment recycling (WEEE)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-United-Nations-UN-SDG-12"><span class="toc-nav-number">1.3.2.</span> <span class="toc-nav-text">2. United Nations (UN): SDG 12</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#05-ARM-Cortex-M4-Processor-Architecture"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">05 ARM Cortex-M4 Processor Architecture</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-Embedded-Processors"><span class="toc-nav-number">1.4.1.</span> <span class="toc-nav-text">1. Embedded Processors</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-Stored-Program-Concept"><span class="toc-nav-number">1.4.2.</span> <span class="toc-nav-text">2. Stored Program Concept</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-computer"><span class="toc-nav-number">1.4.2.1.</span> <span class="toc-nav-text">(1) computer</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Von-Neumann-Architecture"><span class="toc-nav-number">1.4.2.2.</span> <span class="toc-nav-text">(2) Von Neumann Architecture</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Fetch-Decode-Execute-Cycle"><span class="toc-nav-number">1.4.2.3.</span> <span class="toc-nav-text">(3) Fetch-Decode-Execute Cycle</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-Harvard-Architecture-%E5%93%88%E4%BD%9B%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-nav-number">1.4.2.4.</span> <span class="toc-nav-text">(4) Harvard Architecture   哈佛体系结构</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-Von-Neumann%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%92%8CHarvard%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94%EF%BC%9A"><span class="toc-nav-number">1.4.2.5.</span> <span class="toc-nav-text">(5) Von Neumann体系结构和Harvard体系结构对比：</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-Instructions"><span class="toc-nav-number">1.4.3.</span> <span class="toc-nav-text">3. Instructions</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-%E8%AF%AD%E8%A8%80"><span class="toc-nav-number">1.4.3.1.</span> <span class="toc-nav-text">(1) 语言</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-Operands-amp-Registers-%E6%93%8D%E4%BD%9C%E6%95%B0%E5%92%8C%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-nav-number">1.4.3.2.</span> <span class="toc-nav-text">(2) Operands &amp; Registers 操作数和寄存器</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Binary-Representation"><span class="toc-nav-number">1.4.3.3.</span> <span class="toc-nav-text">(3) Binary Representation</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-Compilation-and-Assembling-%E7%BC%96%E8%AF%91%E5%92%8C%E7%BB%84%E8%A3%85"><span class="toc-nav-number">1.4.3.4.</span> <span class="toc-nav-text">(4) Compilation and Assembling 编译和组装</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-ARM"><span class="toc-nav-number">1.4.4.</span> <span class="toc-nav-text">4. ARM</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-ARM-Architecture"><span class="toc-nav-number">1.4.4.1.</span> <span class="toc-nav-text">(1) ARM Architecture</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-ARM-Cortex-M-Series"><span class="toc-nav-number">1.4.4.2.</span> <span class="toc-nav-text">(2) ARM Cortex-M Series</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-Cortex-M4"><span class="toc-nav-number">1.4.5.</span> <span class="toc-nav-text">5. Cortex-M4</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-Processor-Overview"><span class="toc-nav-number">1.4.5.1.</span> <span class="toc-nav-text">(1) Processor: Overview</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-3-stage-Pipeline"><span class="toc-nav-number">1.4.5.2.</span> <span class="toc-nav-text">(2) 3-stage Pipeline</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-Registers"><span class="toc-nav-number">1.4.5.3.</span> <span class="toc-nav-text">(3) Registers</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-Memory-Map"><span class="toc-nav-number">1.4.5.4.</span> <span class="toc-nav-text">(4) Memory Map</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-Program-Image-%E7%A8%8B%E5%BA%8F%E9%95%9C%E5%83%8F%EF%BC%88code-region%EF%BC%89"><span class="toc-nav-number">1.4.5.5.</span> <span class="toc-nav-text">(5)Program Image  程序镜像（code region）</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#6-Endianness-%E5%AD%97%E8%8A%82%E9%A1%BA%E5%BA%8F"><span class="toc-nav-number">1.4.5.6.</span> <span class="toc-nav-text">(6) Endianness  字节顺序</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6-%E6%80%BB%E7%BB%93"><span class="toc-nav-number">1.4.6.</span> <span class="toc-nav-text">6. 总结</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    



      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">特色标签</a>
          </h5>
          <div class="tags">
            
            <a class="tag" href="/tags/#Embedded System" title="Embedded System">Embedded System</a>
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>链友</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://hexo.io/" target="_blank">Hexo</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/YST-10">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          YST
          2024
<!--           <br> -->
<!--           Theme by -->
<!--           <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a> -->
<!--           <span style="display: inline-block; margin: 0 5px;"> -->
<!--             <i class="fa fa-heart"></i> -->
<!--           </span> -->
<!--           re-Ported by -->
<!--           <a target="_blank" rel="noopener" href="https://v-vincen.life/">Live My Life</a> -->
<!--           | -->
<!--           <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe> -->
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  
    <!-- Busuanzi JavaScript -->
    <script async="async" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  
    <!-- LangSelect start -->
    <script type="text/javascript" src="/js/langselect.js"></script>
    <!-- LangSelect end -->
  

  
    <!-- Mouseclick -->
    <script type="text/javascript" src="/js/mouseclick.js" content='加油！加油！,Fighting! Fighting!,Vomos! Vomos!,Komm schon! Komm schon!,Aller! Aller! Aller!' color='#9933CC,#339933,#66CCCC,#FF99CC,#CCCCFF'></script>
  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  






  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  
    <script async="async" type="text/javascript" src="/js/viewer/viewer.min.js"></script>
    <script async="async" type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  

  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("http://example.com/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="搜索..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
